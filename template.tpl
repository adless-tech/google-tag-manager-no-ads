___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "No Ads by Adless",
  "categories": [
    "ADVERTISING",
    "SALES"
  ],
  "brand": {
    "id": "adless",
    "displayName": "Adless",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Automatically earn by serving content without ads!\n\nFor easy tag sequencing, this tag fails if the visitor pays for not seeing ads and succeeds otherwise. See adless.net/get-started/gtm for details.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "earnerID",
    "displayName": "Earner ID",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}"
        ]
      }
    ],
    "help": "You can find your earner ID at adless.net/earnings.",
    "notSetText": "Earner ID is required",
    "alwaysInSummary": false
  },
  {
    "type": "PARAM_TABLE",
    "name": "services",
    "displayName": "Additional services",
    "paramTableColumns": [
      {
        "param": {
          "type": "TEXT",
          "name": "id",
          "displayName": "Service ID",
          "simpleValueType": true,
          "help": "Service ID without quotes.",
          "notSetText": "NO_ADS",
          "valueHint": "NO_ADS"
        },
        "isUnique": true
      }
    ],
    "help": "The service \"NO_ADS\" is automatically used in this tag. Use this field to specify additional services that you provide.",
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "configuration",
    "displayName": "Additional configuration",
    "simpleValueType": true,
    "lineCount": 10,
    "valueHint": "{ \"paywall\": true  }",
    "help": "This field can be used to provide additional settings. The available settings are described in adless.net/get-started. A JSON-encoded string is expected.",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "\\s*\\{(.|\\s)*\\}\\s*"
        ]
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const callInWindow = require('callInWindow');
const JSON = require('JSON');
const writeToDL = require('gtagSet');

injectScript("https://static.adless.net/adless.js", () => {
    const cfg = data.configuration ? JSON.parse(data.configuration) : {};
    cfg.earner = data.earnerID;
    cfg.services = ["NO_ADS"].concat(data.services ? data.services.map(s => s.id) : []);
  
    const oldRejectServices = cfg.onRejectServices;
    cfg.onRejectServices = function(services) {
      writeToDL({
        "adless": {
          "reject": services
        }
      });
      
      if((services || []).filter(s => s == "NO_ADS").length > 0) {
         data.gtmOnSuccess();
      } else {
        data.gtmOnFailure();
      }
      
      if(oldRejectServices) {
        oldRejectServices();
      }
    };
  
    const oldProvideServices = cfg.onProvideServices;
    cfg.onProvideServices = function(services) {
      writeToDL({
        "adless": {
          "provide": services
        }
      });
      
       if((services || []).filter(s => s == "NO_ADS").length > 0) {
         data.gtmOnFailure();
       }
       
      if(oldProvideServices) {
        oldProvideServices(services);
      }
    };
  
    callInWindow("adless.push", cfg);
}, data.gtmOnFailure);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adless.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://static.adless.net/adless.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "adless.*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 21.6.2022 10.56.27


